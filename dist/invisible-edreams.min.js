/*
 *  invisible-edreams - v4.1.0
 *  
 *  
 *
 *  Made by 
 *  Under MIT License
 */
!function(a,b,c,d,e,f){"use strict";function g(b,c){this.element=b,this.settings=a.extend({},i,c),this._defaults=i,this._name=h,this.currentModuleId=1,this.focusOnModule=1,this.currentFocus=this.settings.focusAreas[0],this.init(),this.datesModule=[3,4]}var h="invisibleEdreams",i={propertyName:"value",focusAreas:["input","controls","settings"],speechLanguage:"Google UK English Male"};a.extend(g.prototype,{init:function(){this.testFunction("hello!!!"),this.showKeyboard(),this.eventHandlers(),this.generateVoiceCommands({Barcelona:"(Barcelona)",Berlin:"(Berlin)","22/04/2016":"(next week)","17/04/2016":"(this weekend)"}),c.OnVoiceReady=_.bind(function(){this.readModuleHeaders()},this)},eventHandlers:function(){a(e).on("keydown",_.bind(this.getKeyEvent,this)),a(d).on("gamepadconnected",_.bind(this.gamepadConnected,this)),a(d).on("gamepaddisconnected",_.bind(this.gamepadDisconnected,this))},testFunction:function(a){console.log(a,this.settings.propertyName)},showKeyboard:function(){var b=this.createAlphabet();a(this.element).find(".ue-keyboard").append(b)},createAlphabet:function(){var a,b;a=_.map(_.range("a".charCodeAt(0),"z".charCodeAt(0)+1),function(a){return String.fromCharCode(a)});for(var c=0;10>c;c++)a.push(c);b="<ul>";for(var d=0;d<a.length;d++)b+='<li data-id="'+d+'">'+a[d]+"</li>";return b+="</ul>"},showSidebarWidget:function(b){var c=a(".ue-sidebar-widgets");c.find("li").removeClass("show"),c.find('li[data-widget-name="'+b+'"]').addClass("show")},navigateKeyboard:function(b){var c,d=a(".ue-keyboard"),e=d.find("li").length,f=d.find("li.active").data("id")||0;console.log("keys",e),"right"===b?c=f+1>e?0:f+1:"left"===b?c=0>f-1?e-1:f-1:"enter"===b&&(this.writeText(),c=f),d.find("li").removeClass("active"),d.find('li[data-id="'+c+'"]').addClass("active")},navigateModules:function(b){var c,d=a(this.element).find(".ue-module"),e=d.filter(".active").data("ue-module")||1;"right"===b?(c=e+1>d.length?0:e+1,this.currentModuleId+=1):"left"===b&&(c=0>e-1?d.length-1:e-1,this.currentModuleId-=1),d.removeClass("active"),d.filter('[data-ue-module="'+c+'"]').addClass("active"),this.currentModuleId=c,this.readModuleHeaders()},navigateSettings:function(a){var b=this.settings.focusAreas,c=b.indexOf(this.getFocus());"up"===a&&c+1<b.length?this.setFocus(c+1):"down"===a&&c-1>=0&&this.setFocus(c-1)},navigateControls:function(b){var c,d=a(this.element).find("#ue-controls li"),e=d.filter(".show"),f=e.data("ue-control-id")||0,g=e.data("ue-control-name")||"key";"right"===b?c=f+1>=d.length?0:f+1:"left"===b?c=0>f-1?d.length-1:f-1:"enter"===b&&(e.toggleClass("show"),this.showSidebarWidget(g),c=f),d.removeClass("show"),d.filter('[data-ue-control-id="'+c+'"]').addClass("show"),_.contains(this.datesModule,c)&&(this.focusOnModule=1)},navigateHandler:function(a,b){if("right"===a||"left"===a)switch(b){case"input":_.contains(this.datesModule,this.currentModuleId)?this.modifyDates(a,b):this.navigateModules(a);break;case"controls":this.navigateControls(a);break;case"settings":this.navigateKeyboard(a)}else if("up"===a||"down"===a)_.contains(this.datesModule,this.currentModuleId)?this.navigateDates(b,a):this.navigateSettings(a);else if("enter"===a)switch(b){case"controls":this.navigateControls(a);break;case"settings":this.navigateKeyboard(a)}},modifyDates:function(b,c){var d=a('[data-ue-module="'+this.currentModuleId+'"]');switch(this.focusOnModule){case 1:var e=parseInt(d.find("input[data-day]").attr("data-day"));this.changeDay(e,b,d);break;case 2:var f=parseInt(d.find("input[data-month]").attr("data-month")),g=parseInt(d.find("input[data-year]").attr("data-year"));this.changeMonth(f,g,b,d)}},changeMonth:function(a,b,c,d){"right"===c?12===a?(a=1,b+=1):a+=1:1===a?(a=12,b-=1):a-=1,d.find("input[data-month]").attr("data-month",a),d.find("input[data-year]").attr("data-year",b),d.find("[data-ue-focus=2]").val(this.getMonthText(a).toUpperCase()+", "+b)},getMonthText:function(a){var b=["January","February","March","April","May","Juny","July","August","September","October","November","December"];return b[a-1]},changeDay:function(a,b,c){"right"===b?31>a&&(a+=1):1!==a&&(a-=1),c.find("input[data-day]").attr("data-day",a),c.find("[data-ue-focus=1]").val(a)},navigateDates:function(a,b){if("up"===b)switch(this.focusOnModule){case 1:this.focusOnModule=1,this.navigateModules("left");break;case 2:this.focusOnModule-=1}else 1===this.focusOnModule&&(this.focusOnModule+=1)},errorValidate:function(a){},validateDates:function(a){var b=parseInt(a.find("input[data-day]").attr("data-day")),c=parseInt(a.find("input[data-month]").attr("data-month")),d=parseInt(a.find("input[data-year]").attr("data-year")),e=new Date(d,c-1,b),f=!e||e.getFullYear()===d&&e.getMonth()===c-1&&e.getDate()===b;return f},getFocus:function(){return this.currentFocus},setFocus:function(a){this.currentFocus=this.settings.focusAreas[a]},writeText:function(){var b=this.getCurrentModule().find("input").val(),c=a(this.element).find(".ue-keyboard li.active").text().toLowerCase();this.fillOutInput(b+c)},removeText:function(){var b=a('input[name="test"]'),c=b.val();b.val(c.slice(0,-1))},readText:function(a){},readModuleHeaders:function(){var b=this.getCurrentModule().find("h3[data-ue-speech], h5[data-ue-speech]");_.each(b,function(b){this.readText(a(b).data("ue-speech"))},this)},fillOutInput:function(a){this.getCurrentModule().find("input").val(a)},getCurrentModule:function(){return a('[data-ue-module="'+this.currentModuleId+'"]')},gamepadConnected:function(){console.log("Gamepad connected.");d.setInterval(_.bind(this.checkGamepad,this),200)},gamepadDisconnected:function(){console.log("Gamepad disconnected!")},checkGamepad:function(){var a=navigator.getGamepads()[0];a.buttons[0].pressed,a.buttons[1].pressed&&this.navigateKeyboard("right"),a.buttons[2].pressed&&this.navigateKeyboard("left"),a.buttons[3].pressed,a.buttons[4].pressed&&this.removeText(),a.buttons[5].pressed&&this.writeText()},activateVoice:function(){b.start()},deActivateVoice:function(){b.stop()},debugVoice:function(){b.addCallback("resultMatch",function(a,b,c){console.log("said: "+a+", cmd: "+b+", phrases: "+c)}),b.debug()},generateVoiceCommands:function(a){var c=_.object(_.map(a,function(a,b){return[a,_.bind(function(){this.fillOutInput(b)},this)]},this));b.addCommands(c),this.debugVoice()},getKeyEvent:function(b){switch(b.keyCode){case 13:if(_.contains(this.datesModule,this.currentModuleId)){var c=a('[data-ue-module="'+this.currentModuleId+'"]');this.validateDates(c)?(this.focusOnModule=1,this.navigateModules("right")):this.errorValidate(c)}else this.writeText();break;case 39:this.navigateHandler("right",this.currentFocus);break;case 37:this.navigateHandler("left",this.currentFocus);break;case 38:this.navigateHandler("up");break;case 40:this.navigateHandler("down")}}}),a.fn[h]=function(b){return this.each(function(){a.data(this,"plugin_"+h)||a.data(this,"plugin_"+h,new g(this,b))})}}(jQuery,annyang,responsiveVoice,window,document);